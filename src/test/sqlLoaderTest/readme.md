# SQL*Loaderのテスト実施手順

ローカル環境でSQL*Loaderを実行して動作確認を行う手順を記載する。

## 事前準備

1. ローカル環境のOracleに以下のユーザを作成する。(既に作成している場合は不要)

    | user | password |
    |:-----|:---------|
    | ssd  | ssd      |

2. createTable.batを実行し、PERSONテーブルを作成する。

## テスト実施

### 正常にデータをロードするケースのテスト

1. successディレクトリ配下に移動する。

2. execute.batを実行する。

3. 2.の実行時に作成されたlogファイルを確認し、3件のロードに成功していることを確認する。

4. PERSONテーブルに以下のデータが登録されていることを確認する。

    | LINE_NUMBER | PERSON_ID  | AGE         | NAME         |
    |:------------|:-----------|:------------|:-------------|
    | 2           | 1          | 20          | 山田太郎      |
    | 3           | 2          | 25          | 田中次郎      |
    | 4           | 3          | 30          | 鈴木三郎      |

### 不正データが存在するケースのテスト

1. badディレクトリ配下に移動する。

2. execute.batを実行する。

3. 2.の実行時に作成されたlogファイルを確認し、2件のロードに成功して1件のロードに失敗していることを確認する。

4. 2.の実行時に作成されたbadファイルを確認し、以下のデータが記載されていることを確認する。

    | PERSON_ID  | AGE         | NAME         |
    |:-----------|:------------|:-------------|
    | 2          | 2500        | 田中次郎      |

5. PERSONテーブルに以下のデータが登録されていることを確認する。

    | LINE_NUMBER | PERSON_ID  | AGE         | NAME         |
    |:------------|:-----------|:------------|:-------------|
    | 2           | 1          | 20          | 山田太郎      |
    | 4           | 3          | 30          | 鈴木三郎      |

### 存在しないテーブルにデータをロードするケースのテスト

1. failed_notExistTableディレクトリ配下に移動する。

2. execute.batを実行する。

3. 2.の実行時に作成されたlogファイルを確認し、テーブルが存在しない旨のエラーメッセージが記載されていることを確認する。

4. PERSONテーブルにデータが登録されていないことを確認する。

### CTLファイルに構文エラーがあるケースのテスト

1. failed_ctlSyntaxErrorディレクトリ配下に移動する。

2. execute.batを実行する。

3. 2.の実行時に作成されたlogファイルを確認し、構文エラーがある旨のエラーメッセージが記載されていることを確認する。

4. PERSONテーブルにデータが登録されていないことを確認する。

### CTLファイルに存在しないカラム名を指定したケースのテスト

1. failed_notExistColumnディレクトリ配下に移動する。

2. execute.batを実行する。

3. 2.の実行時に作成されたlogファイルを確認し、カラムが存在しない旨のエラーメッセージが記載されていることを確認する。

4. PERSONテーブルにデータが登録されていないことを確認する。
